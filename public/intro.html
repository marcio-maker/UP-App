<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#3a6ea5" />
  <title>Universidade de Pais — Conectando Famílias</title>

  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
  <script src="auth.js" type="module"></script>

  <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.1/three.module.min.js"></script>

  <style>
    :root {
      --primary: #3a6ea5;
      --accent: #a29bfe;
      --dark-bg: #1e272e;
      --text-light: #f0f0f0;
    }

    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Inter', sans-serif;
      background-color: var(--dark-bg);
      color: var(--text-light);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      position: relative;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      display: block;
      z-index: 0;
    }

    .intro-overlay {
      position: relative;
      z-index: 1;
      text-align: center;
      padding: 40px 25px;
      border-radius: 16px;
      background-color: rgba(30, 39, 46, 0.35);
      border: 1px solid rgba(162, 155, 254, 0.3);
      box-shadow: 0 0 40px rgba(58, 110, 165, 0.4);
      backdrop-filter: blur(8px);
      max-width: 600px;
      animation: fadeIn 2s ease forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      font-size: 2.8em;
      margin-bottom: 15px;
      color: #fff;
      text-shadow: 0 0 15px var(--accent);
      animation: glow 3s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 0 0 10px var(--accent); }
      to { text-shadow: 0 0 25px var(--primary); }
    }

    p {
      font-size: 1.25em;
      color: #d6d6d6;
      line-height: 1.5em;
      margin: 0 auto 25px;
      max-width: 500px;
    }

    #go-to-login {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      border: none;
      padding: 15px 45px;
      font-size: 1.2em;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
    }

    #go-to-login:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(58, 110, 165, 0.6);
    }

    #go-to-login:active {
      transform: scale(0.97);
    }
  </style>
</head>

<body>
  <div class="intro-overlay">
    <h1>Universidade de Pais</h1>
    <p>Um espaço para aprender, compreender e fortalecer os laços entre pais e filhos.  
    Cresça junto com quem você mais ama.</p>
    <button id="go-to-login">Entrar na Jornada</button>
  </div>

  <script type="module">
    import * as THREE from 'https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.1/three.module.min.js';

    let scene, camera, renderer, particles, particlePositions;
    let mouseX = 0, mouseY = 0;
    let windowHalfX = window.innerWidth / 2;
    let windowHalfY = window.innerHeight / 2;

    const THEME_PRIMARY_COLOR = 0x3a6ea5;
    const THEME_DARK_BG_COLOR = 0x1e272e;
    const PARTICLE_COUNT = 500;
    const CONNECTION_DISTANCE = 100;
    const PARTICLE_SIZE = 2;

    function init() {
      scene = new THREE.Scene();
      scene.fog = new THREE.Fog(THEME_DARK_BG_COLOR, 1, 2500);

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 4000);
      camera.position.z = 1000;

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      document.body.appendChild(renderer.domElement);

      const range = 1000;
      particlePositions = new Float32Array(PARTICLE_COUNT * 3);

      for (let i = 0; i < PARTICLE_COUNT; i++) {
        const i3 = i * 3;
        particlePositions[i3 + 0] = Math.random() * range - range / 2;
        particlePositions[i3 + 1] = Math.random() * range - range / 2;
        particlePositions[i3 + 2] = Math.random() * range - range / 2;
      }

      const particleGeometry = new THREE.BufferGeometry();
      particleGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));

      const particleMaterial = new THREE.PointsMaterial({
        color: THEME_PRIMARY_COLOR,
        size: PARTICLE_SIZE,
        transparent: true,
        opacity: 0.9,
        blending: THREE.AdditiveBlending
      });

      particles = new THREE.Points(particleGeometry, particleMaterial);
      scene.add(particles);

      document.addEventListener('mousemove', onDocumentMouseMove, false);
      window.addEventListener('resize', onWindowResize, false);
    }

    function onDocumentMouseMove(event) {
      mouseX = (event.clientX - windowHalfX) * 0.05;
      mouseY = (event.clientY - windowHalfY) * 0.05;
    }

    function onWindowResize() {
      windowHalfX = window.innerWidth / 2;
      windowHalfY = window.innerHeight / 2;
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
      requestAnimationFrame(animate);

      for (let i = 0; i < PARTICLE_COUNT; i++) {
        particlePositions[i * 3 + 2] += 0.5;
        if (particlePositions[i * 3 + 2] > camera.position.z + 1000) {
          particlePositions[i * 3 + 2] = camera.position.z - 1000;
        }
      }
      particles.geometry.attributes.position.needsUpdate = true;

      camera.position.x += (mouseX - camera.position.x) * 0.005;
      camera.position.y += (-mouseY - camera.position.y) * 0.005;
      camera.lookAt(scene.position);

      renderer.render(scene, camera);
    }

    function redirectToAppOrLogin() {
      try {
        console.log('Botão "Entrar" clicado. Verificando sessão...');
        if (window.auth && typeof window.auth.isLoggedIn === 'function' && window.auth.isLoggedIn()) {
          console.log('Usuário logado, redirecionando para app...');
          window.location.replace('index.html');
        } else {
          console.log('Usuário não logado, redirecionando para login...');
          window.location.replace('login.html');
        }
      } catch (error) {
        console.error('Erro de Autenticação na transição:', error);
        window.location.replace('login.html');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      init();
      animate();

      const button = document.getElementById('go-to-login');
      if (button) button.addEventListener('click', redirectToAppOrLogin);
    });
  </script>
</body>
</html>
